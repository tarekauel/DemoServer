<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>Demo</title>

    <!-- Bootstrap CSS Toolkit styles -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
</head>

<body>
<div role="tabpanel">
    <nav class="navbar navbar-inverse navbar-static-top">
        <div class="container-fluid">
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="myTab">
                <ul class="nav navbar-nav" role="tablist">
                    <li class="active" role="presentation"><a href="#spreading-activation" aria-controls="spreading-activation" role="tab" data-toggle="tab">Context</a></li>
                    <li role="presentation"><a href="#network-distance" aria-controls="profile" role="tab" data-toggle="tab">Similarity</a></li>
                    <li role="presentation"><a href="#add-data-triple" aria-controls="profile" role="tab" data-toggle="tab">Add Data Triple</a></li>
                </ul>

            </div><!-- /.navbar-collapse -->
        </div><!-- /.container-fluid -->
    </nav>
    <div class="tab-content container">
        <div class="alert alert-info" id="report-status" style="display: none">current status: running</div>
        <!--<div class="alert" id="performance" style="display: none">
            visited vertices <b id="aggregates"></b>, runtime: <b id="runtime"></b>ms
            <button class="btn btn-sm btn-info" id="change-modus">Change to detailed</button>
        </div>-->
        <div role="tabpanel" class="tab-pane active" id="spreading-activation">
            <form id="spreading-activation-form" onsubmit="false">
                <div class="form-group" id="spreading-activation-searchbox">
                    <label class="control-label" for="spreading-activation-company-input" id="searchbox-error-text">Entity not found</label>
                    <div id="scrollable-dropdown-menu" style="display: inline">
                        <input id="spreading-activation-company-input" class="typeahead form-control input-lg" type="text" placeholder="input an entity name">
                    </div>
                </div>
                <button class="btn btn-primary btn-lg" id="spreading-activation-button" style="margin-bottom:5px;">Send</button>
            </form>
            <div>
                <table id="spreading-activation-result-table" class="table table-striped">
                    <thead>
                    <tr><th><div class="dropdown">
                        <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
                            Filter
                            <span class="caret"></span>
                        </button>
                        <ul id="filter_dd_sa" class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                            <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Action</a></li>
                        </ul>
                    </div></th><th>Value</th><th></th></tr>
                    </thead>

                </table>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="network-distance">
            <form id="network-distance-form">
                <div class="form-group" id="network-distance-searchbox">
                    <div>
                        <label class="control-label" for="network-distance-company-input-a" id="network-distance-error-text-a">Company not found</label>
                        <input id="network-distance-company-input-a" class="typeahead form-control input-lg" type="text" placeholder="input a company name">
                    </div>
                    <div>
                        <label class="control-label" for="network-distance-company-input-b" id="network-distance-error-text-b">Company not found</label>
                        <input id="network-distance-company-input-b" class="typeahead form-control input-lg" type="text" placeholder="input a company name">
                    </div>
                    <div style="text-align: right; margin-top: 25px;">
                        <button class="btn btn-primary btn-lg" id="network-distance-button">Send</button>
                    </div>
                </div>
            </form>
            <div>
                <table id="network-distance-result-table" class="table table-striped">
                    <thead>
                    <tr><th>entity a</th><th>entity b</th><th>distance</th></tr>
                    </thead>

                </table>
            </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="add-data-triple">
            <form id="add-data-triple-form">
                <div class="form-group" id="add-data-triple-form-searchbox">
                    <div data-trigger="focus" data-html="true" data-toggle="popover" id="add-data-triple-subject-popover"
                         data-placement="right" title="Do you miss a vertex?" data-content='<a href="#" id="show-input-Subject">Click here to add a new vertex</a>'>
                        <input id="add-data-triple-subject" class="typeahead form-control input-lg" type="text"
                               placeholder="input an entity name">
                    </div>
                    <div>
                        <div class="dropdown" style="margin: 10px 0" id="add-data-triple-predikat-wrapper" data-trigger="focus" data-html="true" data-toggle="popover"
                             data-placement="right" title="Do you miss an edge type?" data-content='<a href="#" id="showFormForEdgeTypes">Clicke here to add a new edge type</a>'>
                            <button class="btn btn-default dropdown-toggle" type="button" id="add-data-triple-predikat" data-toggle="dropdown" aria-expanded="true">
                                <span id="add-data-triple-predikat-btn-text">select an edge type</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="add-data-triple-predikat" id="add-data-triple-predikat-list">

                            </ul>
                        </div>
                    </div>
                    <div data-trigger="focus" data-html="true" data-toggle="popover" id="add-data-triple-object-popover"
                         data-placement="right" title="Do you miss a vertex?" data-content='<a href="#" id="show-input-Object">Click here to add a new vertex</a>'>
                        <input id="add-data-triple-object" class="typeahead form-control input-lg" type="text" placeholder="input a company name">
                    </div>
                    <div style="text-align: right; margin-top: 25px;">
                        <button class="btn btn-primary btn-lg" id="add-data-triple-form-button">Send</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Add a new entity</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <div class="form-group">
                        <input id="new-vertex-id" class="typeahead form-control" type="text" placeholder="id">
                            </div><div class="form-group">
                        <input id="new-vertex-name" class="typeahead form-control" type="text" placeholder="name">
                        </div>
                        <div class="dropdown" style="margin: 10px 0">
                            <button class="btn btn-default dropdown-toggle" type="button" id="new-vertex-type-dropdown" data-toggle="dropdown" aria-expanded="true">
                                <span id="new-vertex-type-dropdown-text">select an vertex type</span>
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="add-data-triple-predikat" id="new-vertex-type-dropdown-list">

                            </ul>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="new-vertex-save">Add</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="addEdgeTypesModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title">Add a new edge type</h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label class="control-label" for="new-edge-type-name">Please specify the name of the edge type (no spaces)</label>
                        <input id="new-edge-type-name" class="typeahead form-control" type="text" placeholder="edge type name">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" id="add-edge-type-save">Add</button>
            </div>
        </div>
    </div>
</div>

<!-- Load jQuery and the typeahead JS files -->
<script src="js/typeahead.bundle.js"></script>
<script src="js/modal.js"></script>
<script src="js/bootstrap-tooltip.js"></script>
<script src="js/jquery.toaster.js"></script>

<script type="text/javascript">

    var selectedCompany = {};
    var map = {};
    var map_reverse = {};
    var spreadingActivationCompanyInput = $('#spreading-activation-company-input');

    var ndInputA = $('#network-distance-company-input-a');
    var ndInputB = $('#network-distance-company-input-b');
    var addInputA = $('#add-data-triple-subject');
    var addInputB = $('#add-data-triple-object');
    var addInputC = $('#add-data-triple-predikat');

    var selectedEdgeType = undefined;

    var allEdgesTypes = [];
    var allVertexTypes = [];
    var allVertices = [];

    var resultSpreadingActivation = [];
    var searchNodeSpreadingActivation = {};

    $('#spreading-activation-result-table').hide();
    $('#network-distance-result-table').hide();
    jQuery.fn.visible = function() {
        return this.css('visibility', 'visible');
    };

    jQuery.fn.invisible = function() {
        return this.css('visibility', 'hidden');
    };

    $("#searchbox-error-text").invisible();
    $("#network-distance-error-text-a").invisible();
    $("#network-distance-error-text-b").invisible();


    function createCallbackEdges(edge) {
        return function() {
            selectEdgeType(edge)
        }
    }

    function createEdgesDropDown(edge) {
        var edges = allEdgesTypes;
        var edgesDropDown = $('#add-data-triple-predikat-list');
        edges.sort();
        edgesDropDown.empty();
        for (var i = edges.length - 1; i >= 0; i--) {
            edgesDropDown.prepend('<li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="edges-type-' + edges[i] + '">' + edges[i] + '</a></li>');
            jQuery("#edges-type-" + edges[i]).click(createCallbackEdges(edges[i]));
        }
        if (edge != undefined) {
            selectEdgeType(edge);
        }
    }

    function selectEdgeType(edge) {
        selectedEdgeType = edge;
        console.log("Selected edge type " + edge);
        $('#add-data-triple-predikat-btn-text').text(edge);
    }


    function buildAutoSuggestion() {
        data = allVertices;
        var states = [];
        data.forEach(function (elem) {
            states.push(elem.name + " (" + elem.type + ")");
            map[elem.name + " (" + elem.type + ")"] = elem["__id"];
            map_reverse[elem["__id"]] = elem.name;
        });

        states = new Bloodhound({
            datumTokenizer: Bloodhound.tokenizers.obj.whitespace('value'),
            queryTokenizer: Bloodhound.tokenizers.whitespace,
            limit: 25,
            // `states` is an array of state names defined in "The Basics"
            local: $.map(states, function (state) {
                return {value: state};
            })
        });

        function changeToSuccess(id, textId) {
            var tag = $(id);
            tag.addClass("has-success");
            tag.removeClass("has-error");
            if (textId !== undefined) {
                $(textId).invisible();
            }
        }

        function changeToFailure(id, textId) {
            var tag = $(id);
            tag.addClass("has-error");
            tag.removeClass("has-success");
            if (textId !== undefined) {
                $(textId).visible();
            }
        }

        // kicks off the loading/processing of `local` and `prefetch`
        states.initialize();

        addDropDown(spreadingActivationCompanyInput, "#searchbox-error-text", "#spreading-activation-searchbox");
        addDropDown(ndInputA, "#network-distance-error-text-a", "#network-distance-searchbox");
        addDropDown(ndInputB, "#network-distance-error-text-b", "#network-distance-searchbox");

        addDropDown(addInputA, "#add-data-triple-subject-error-text", "#network-distance-searchbox");
        addDropDown(addInputB, "#add-data-triple-object-error-text", "#network-distance-searchbox");

        function addDropDown(tag, inputErrorText, searchBox) {
            tag.typeahead('destroy');
            tag.typeahead({
                        hint: true,
                        highlight: true,
                        minLength: 1
                    },
                    {
                        name: 'states',
                        displayKey: 'value',
                        source: states.ttAdapter()
                    }).on('typeahead:selected', function (event, data) {
                        console.log('selected item' + map[data.value]);
                        changeToSuccess(searchBox, inputErrorText);
                        selectedCompany[tag.attr('id')] = map[data.value];
                        selectedCompany[tag.attr('id') + "_name"] = data.value;
                    })/*.on('typeahead:closed', function (event, data) {
             var val = tag.val();
             if (map[val] === undefined) {
             tag.focus();
             changeToFailure(searchBox, inputErrorText);
             }
             console.log('selected item' + map[val]);
             selectedCompany[tag.attr('id')] = map[val];
             });*/

            tag.blur(function () {
                tag.val(selectedCompany[tag.attr('id') + "_name"]);
            })
        }
    }

    (function() {
        $.getJSON('data.json', function (data) {
            allVertices = data;
            buildAutoSuggestion();
        });


        $.getJSON('edgeTypes.json', function (data) {
            allEdgesTypes = data;
            createEdgesDropDown();
        });

        $('#add-data-triple-subject').focus(function() {
            $('#add-data-triple-subject').popover('show');
        });

        $.getJSON('vertexTypes.json', function (data) {
            // ignore them because you can not search for all of them
            data = ["Organization","City","Category","keyword","Region","Country","Person","TeamMember","Founder","Advisor"];
            data.sort();
            for(var i=0; i < data.length; i++) {
                $("#new-vertex-type-dropdown-list").prepend('<li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="vertex-type-' + data[i] + '">' + data[i] + '</a></li>')
                $("#vertex-type-" + data[i]).click((function() {
                    var vertex = data[i];
                    return function() {
                        $("#new-vertex-type-dropdown-text").text(vertex);
                    }
                })());
            }
        });

    })();

    function spreading_activation() {
        if (selectedCompany[spreadingActivationCompanyInput.attr('id')] != undefined) {
            $.getJSON('spreading_activation?entity=' + selectedCompany[spreadingActivationCompanyInput.attr('id')], function(data) {
                data;
                maxResult = 0.0;
                searchNodeSpreadingActivation = $.grep(data, function(e){ return e.id == selectedCompany[spreadingActivationCompanyInput.attr('id')]; });
                resultTemp = [];
                for (var i=0; i!= data.length; ++i) {
                    if (data[i].id != selectedCompany[spreadingActivationCompanyInput.attr('id')]) {
                        resultTemp.push(data[i]);
                    }
                }
                for (var i=0; i != resultTemp.length; ++i) {
                    if (parseFloat(resultTemp[i].value) > maxResult) {
                        maxResult = parseFloat(resultTemp[i].value);
                    }
                }
                for (var i=0; i != resultTemp.length; ++i) {
                    resultTemp[i].old_value = resultTemp[i].value;
                    resultTemp[i].value = parseFloat(resultTemp[i].value) / maxResult;
                }
                resultSpreadingActivation = resultTemp;
                displaySAResult()
            });
        }
    }

    $('#spreading-activation-button').click(function(e){
        spreading_activation();
        e.preventDefault();
        return false;
    });

    $('#network-distance-button').click(function(e){
        if (selectedCompany[ndInputA.attr('id')] != undefined && selectedCompany[ndInputB.attr('id')] != undefined) {
            $.getJSON("distance_algorithm?entity1=" + selectedCompany[ndInputA.attr('id')] + "&entity2=" + selectedCompany[ndInputB.attr('id')],function(result){
                $('#network-distance-result-table').show();
                $('#network-distance-result-table').prepend($('<tr>').html("<td>" + result.companyA.name + " (" + result.companyA.type + ")</td><td>" + result.companyB.name + " (" + result.companyB.type + ")</td><td>" + result.distance + " hops</td>"));
                $('.container').animate({"margin-top": "30px"});
            });
        }
        e.preventDefault();
        return false;
    });

    $('#network-distance').submit(function(){
        socket.emit('start network distance', selectedCompany[ndInputA.attr('id')] + "\n" + selectedCompany[ndInputB.attr('id')]);
        return false;
    });

    function idToLink(id) {
        if (id.indexOf("http") == 0) {
            return "<a href=\"" + id + "\" target=\"_blank\">" + id + "&nbsp;<span class=\"glyphicon glyphicon-new-window\"></span></a>";
        } else {
            if (map[id] != undefined) {

            } else {
                return id;
            }
        }
    }

    function createCallback(type,key){
        var new_list = JSON.parse(JSON.stringify(type));
        if (new_list.indexOf(key) == -1) {
            new_list.push(key);
        } else {
            new_list.splice(new_list.indexOf(key),1);
        }
        return function(e){
            displaySAResult(new_list);
            e.preventDefault();
            return false;
        }
    }

    function createCallbackChangeItem(name){
        return function(e){
            var id = "spreading-activation-company-input";
            $('#' + id).val(name);
            selectedCompany[id] = map[name];
            selectedCompany[id + "_name"] = name;
            spreading_activation();
            e.preventDefault();
            return false;
        }
    }

    function createCallbackShowItems(className) {
        return function(e) {
            var tags = "." + className;
            if ($(tags).css('display') === "none") {
                $(".tracking").css('display',"none");
                $(tags).css('display',"");
            } else {
                $(".tracking").css('display',"none");
            }
        }
    }

    function displaySAResult(type) {
        if (!type) type = [];
        var typeSet = {};
        var result = [];
        for (var j=0; j < resultSpreadingActivation.length; j++) {
            if (resultSpreadingActivation[j].value != "0") {
                result.push(resultSpreadingActivation[j]);
            } else { continue; }
            if (resultSpreadingActivation[j].type == "") continue;
            typeSet[resultSpreadingActivation[j].type] = true;
        }
        var dd = $('#filter_dd_sa');
        dd.empty();

        for (var key in typeSet) {
            dd.append('<li role="presentation"><a role="menuitem" tabindex="-1" href="#' + key + '" id="action-sa-' + key + '"><input type="checkbox" id="action-sa-' + key + '-cb" /><label>&nbsp;' + key + '</label></a></li>');
            jQuery("#action-sa-" + key).click(createCallback(type,key));
            if (type.indexOf(key) != -1) {
                jQuery("#action-sa-" + key + "-cb").attr("checked","checked");
            }
        }
        dd.append('<li role="presentation" class="divider"></li>');
        dd.append('<li role="presentation"><a role="menuitem" tabindex="-1" id="action-sa-other"><input type="checkbox" id="action-sa-other-cb" /><label>&nbsp;Other</label></a></li>');
        jQuery("#action-sa-other").click(function(e){
            type.push("");
            displaySAResult(type);
        });
        if (type.indexOf("") != -1) {
            jQuery("#action-sa-other-cb").attr("checked", "checked");
        }
        dd.append('<li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="action-sa-all"><input type="checkbox" style="visibility: hidden"/><label>&nbsp;All Types</label></a></li>');
        jQuery("#action-sa-all").click(function(e){
            displaySAResult([]);
        });


        result = [];
        for (var k=0; k < resultSpreadingActivation.length; k++) {
            if (type.indexOf(resultSpreadingActivation[k].type) != -1 || type.length === 0) {
                result.push(resultSpreadingActivation[k]);
            }
        }

        $('#spreading-activation-result-table').show();
        $("#spreading-activation-result-table > tbody").html("");
        for (var i=0; i < 10 && i < result.length; i++) {
            var identifier = result[i].id.replace(/\W/g, '');
            if ((result[i].name != "" && ['Organization', 'City', 'Category', 'Keyword', 'Region', 'Country', 'Person'].indexOf(result[i].type) != -1) || (map_reverse[result[i].id] != undefined)) {
                if (result[i].name == "") {
                    result[i].name = map_reverse[result[i].id];
                }
                if (result[i].tracking.length > 0) {
                    $('#spreading-activation-result-table').append($('<tr>').html("<td><a href=\"#\" id=\"sa-result-" + i + "\">" + ((result[i].name != "") ? result[i].name + " (" + result[i].type + ")" : result[i].id) + "</a></td><td>" + Math.round(parseFloat(result[i].value) * 100) / 1.0 + " %</td><td><button id=\"" + identifier + "-show\" class=\"btn btn-default btn-sm\">Explain</button></td>"));
                    jQuery("#sa-result-" + i).click(createCallbackChangeItem(result[i].name + " (" + result[i].type + ")"));
                    jQuery("#" + identifier + "-show").click(createCallbackShowItems(identifier + "-tracking"));
                    for (var j = 0; j < result[i].tracking.length; ++j) {
                        var influence = Math.round(result[i].tracking[j].power / result[i].old_value * result[i].value * 1000)/10.0;
                        if (influence - 0.01 > 0) {
                            var inner_html = "<td colspan='2' class=\"" + identifier + "-tracking tracking\" style=\"display: none\">";
                            for (var k = 0; k < result[i].tracking[j].path.length; ++k) {
                                if (k === 0) {
                                    inner_html += result[i].tracking[j].path[k].node + " --> ";
                                } else {
                                    if (map_reverse[result[i].tracking[j].path[k].node] != undefined) {
                                        inner_html += map_reverse[result[i].tracking[j].path[k].node] + " --> ";
                                    } else {
                                        inner_html += result[i].tracking[j].path[k].node + " --> ";
                                    }
                                }
                            }
                            inner_html += ((result[i].name != "") ? result[i].name + " (" + result[i].type + ")" : result[i].id);
                            inner_html += "</td><td class=\"" + identifier + "-tracking tracking\" style=\"display: none\">" + influence + "%";
                            inner_html += "</td>";
                            $('#spreading-activation-result-table').append($('<tr>').html(inner_html));
                        }
                    }
                } else {
                    $('#spreading-activation-result-table').append($('<tr>').html("<td><a href=\"#\" id=\"sa-result-" + i + "\">" + ((result[i].name != "") ? result[i].name + " (" + result[i].type + ")" : result[i].id) + "</a></td><td>" + Math.round(parseFloat(result[i].value) * 100) / 1.0 + " %</td><td></td>"));
                    jQuery("#sa-result-" + i).click(createCallbackChangeItem(result[i].name + " (" + result[i].type + ")"));
                }
            } else {
                if (result[i].tracking.length > 0) {
                    $('#spreading-activation-result-table').append($('<tr>').html("<td>" + ((result[i].name != "") ? result[i].name + " (" + result[i].type + ")" : idToLink(result[i].id)) + "</td><td>" + Math.round(parseFloat(result[i].value) * 100) / 1.0 + " %</td><td><button id=\"" + identifier + "-show\" class=\"btn btn-default btn-sm\">Explain</button></td>"));
                    jQuery("#" + identifier + "-show").click(createCallbackShowItems(identifier + "-tracking"));
                    for (var j = 0; j < result[i].tracking.length; ++j) {
                        var influence = Math.round(result[i].tracking[j].power / result[i].old_value * result[i].value * 1000)/10.0;
                        if (influence - 0.01 > 0) {
                            var inner_html = "<td colspan='2' class=\"" + identifier + "-tracking tracking\" style=\"display: none\">";
                            for (var k = 0; k < result[i].tracking[j].path.length; ++k) {
                                if (k === 0) {
                                    inner_html += result[i].tracking[j].path[k].node + " --> ";
                                } else {
                                    if (map_reverse[result[i].tracking[j].path[k].node] != undefined) {
                                        inner_html += map_reverse[result[i].tracking[j][k].node] + " --> ";
                                    } else {
                                        inner_html += result[i].tracking[j].path[k].node + " --> ";
                                    }
                                }
                            }
                            inner_html += ((result[i].name != "") ? result[i].name + " (" + result[i].type + ")" : result[i].id);
                            inner_html += "</td><td class=\"" + identifier + "-tracking tracking\" style=\"display: none\">" + influence + "%";
                            inner_html += "</td>";
                            $('#spreading-activation-result-table').append($('<tr>').html(inner_html));
                        }
                    }
                } else {
                    $('#spreading-activation-result-table').append($('<tr>').html("<td>" + ((result[i].name != "") ? result[i].name + " (" + result[i].type + ")" : idToLink(result[i].id)) + "</td><td>" + Math.round(parseFloat(result[i].value) * 100) / 1.0 + " %</td><td></td>"));
                }
            }
        }
        $('.container').animate({"margin-top": "30px"});
    }


    var lastMessageND = undefined;

    var addNewEdgeType = false;
    var addNewVertexType = false;

    function showModal(inputId) {
        $(inputId).click(function(e) {
            $('#myModal').modal('show');
            addNewVertexType = true;
            e.preventDefault();
        });
        $("#new-vertex-save").click(function(e) {
            if (addNewVertexType) {
                addNewVertexType = false;
                var vertex = {};
                vertex.__id = $("#new-vertex-id").val();
                vertex.name = $("#new-vertex-name").val();
                vertex.type = $("#new-vertex-type-dropdown-text").text();
                allVertices.push(vertex);
                console.log("New vertex");
                console.log(vertex);
                $('#myModal').modal('hide');
                e.preventDefault();
                buildAutoSuggestion();
                $.ajax({
                    type: "POST",
                    url: "/vertices/",
                    data: JSON.stringify(vertex),
                    success: function (data, status) {
                        if (status === "success") {
                            $.toaster({priority: 'success', title: 'Success', message: 'vertex successfully created'});
                        } else {
                            $.toaster({priority: 'danger', title: 'Error', message: 'Something went rong'});
                        }
                    },
                    contentType: "application/json;charset=utf-8"
                });
            }
        });
    };

    $('#add-data-triple-subject-popover').on('shown.bs.popover', function () {
        showModal("#show-input-Subject")
    });

    $('#add-data-triple-object-popover').on('shown.bs.popover', function () {
        showModal("#show-input-Object")
    });

    $('#add-data-triple-predikat-wrapper').on('shown.bs.popover', function () {
        $('#showFormForEdgeTypes').click(function(e) {
            $('#new-edge-type-name').val('');
            $('#addEdgeTypesModal').modal('show');
            addNewEdgeType = true;
            e.preventDefault();
        });
        $('#add-edge-type-save').click(function(e) {
            if (addNewEdgeType) {
                addNewEdgeType = false;
                var newEdgeType = $('#new-edge-type-name').val();
                newEdgeType.trim();
                newEdgeType.replace("/\s/g", '');
                allEdgesTypes.push(newEdgeType);
                createEdgesDropDown(newEdgeType);
                $('#addEdgeTypesModal').modal('hide');
                e.preventDefault();
            }
        });
    });

    $("#add-data-triple-form-button").click(function(e) {
        var source = selectedCompany["add-data-triple-subject"];
        var target = selectedCompany["add-data-triple-object"];
        var type = $("#add-data-triple-predikat-btn-text").text();
        var edge = {
            source: source,
            target: target,
            type: type
        };
        console.log(edge);
        $.ajax({
            type: "POST",
            url: "/edges/",
            data: JSON.stringify(edge),
            success: function(data, status) {
                if (status === "success") {
                    $.toaster({ priority : 'success', title : 'Title', message : 'edge successfully created'});
                } else {
                    $.toaster({ priority : 'danger', title : 'Error', message : 'Something went rong'});
                }
            },
            contentType: "application/json;charset=utf-8"
        });
        e.preventDefault();
    });


    $(document).ready(function(){
        $('[data-toggle="popover"]').popover();
    });

</script>
</body>
</html>